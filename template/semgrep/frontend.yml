rules:
  # Frontend numeric constants enforcement
  - id: frontend-enforce-numeric-constants
    languages: [javascript, typescript]
    message: "Use constants for numbers. Put feature constants in frontend/src/**/constants/ and shared constants in frontend/src/constants/."
    severity: ERROR
    patterns:
      - pattern: $N
      - metavariable-regex:
          metavariable: $N
          regex: '^(?!-?1$|0$)(?:-?[0-9]+(?:\.[0-9]+)?)$'
    paths:
      include:
        - /frontend/src/**
      exclude:
        # JUSTIFIED EXCEPTIONS - DO NOT ADD MORE WITHOUT EXHAUSTING ALL ALTERNATIVES
        # - constants/**: Where constants are defined (literals expected by design)
        # Adding exceptions here weakens enforcement - only add if absolutely unavoidable
        - /frontend/src/**/constants/**
        - /frontend/src/constants/**

  # Frontend string constants enforcement
  - id: frontend-enforce-string-constants
    languages: [javascript, typescript]
    message: "Use constants for strings. Put feature constants in frontend/src/**/constants/ and shared constants in frontend/src/constants/."
    severity: ERROR
    patterns:
      - pattern-either:
          # String assignments
          - pattern: $VAR = "$S"
          - pattern: $VAR = '$S'
          # String returns
          - pattern: return "$S"
          - pattern: return '$S'
          # Function arguments with strings
          - pattern: $F(..., "$S", ...)
          - pattern: $F(..., '$S', ...)
      # Exclude JSX attributes (className, data-testid, id, etc.)
      - pattern-not-inside: |
          <$TAG $ATTR="..." ... />
      - pattern-not-inside: |
          <$TAG $ATTR="...">...</$TAG>
      # Exclude type annotations
      - pattern-not-inside: |
          const $VAR: "$TYPE" = ...
      # Exclude i18n translation keys
      - pattern-not-inside: t("...")
      - pattern-not-inside: t('...')
      # Exclude test framework function NAMES (but not test data inside tests)
      - pattern-not-inside: describe("...", ...)
      - pattern-not-inside: it("...", ...)
      - pattern-not-inside: test("...", ...)
      # Exclude console logging
      - pattern-not-inside: console.log("...")
      - pattern-not-inside: console.error("...")
      - pattern-not-inside: console.warn("...")
      - pattern-not-inside: console.info("...")
      - pattern-not-inside: console.debug("...")
    paths:
      include:
        - /frontend/src/**
      exclude:
        # JUSTIFIED EXCEPTIONS - DO NOT ADD MORE WITHOUT EXHAUSTING ALL ALTERNATIVES
        # - constants/**: Where constants are defined (literals expected by design)
        # Adding exceptions here weakens enforcement - only add if absolutely unavoidable
        - /frontend/src/**/constants/**
        - /frontend/src/constants/**

  # Test ID constants enforcement
  - id: frontend-enforce-testid-constants
    languages: [javascript, typescript]
    message: "data-testid requires constant. Create src/constants/testIds.ts: export const TEST_IDS={NAME:'value'}; Import and use: data-testid={TEST_IDS.NAME}"
    severity: ERROR
    patterns:
      - pattern-either:
          # Catch string literals in data-testid
          - pattern: data-testid="..."
          - pattern: data-testid='...'
          - pattern: |
              data-testid={"..."}
          - pattern: |
              data-testid={'...'}
      # Allow variables/constants (not literals)
      - pattern-not-inside: |
          data-testid={$VAR}
      # Allow template literals with interpolation (dynamic test IDs)
      - pattern-not-inside: |
          data-testid={`${...}...`}
      - pattern-not-inside: |
          data-testid={`...${...}`}
    paths:
      include:
        - /frontend/src/**
      exclude:
        # JUSTIFIED EXCEPTIONS - DO NOT ADD MORE WITHOUT EXHAUSTING ALL ALTERNATIVES
        # - constants/**: Where constants are defined (literals expected by design)
        # Adding exceptions here weakens enforcement - only add if absolutely unavoidable
        - /frontend/src/**/constants/**
        - /frontend/src/constants/**

  # Shared JavaScript/TypeScript security rules
  - id: no-eval
    languages: [javascript, typescript]
    patterns:
      - pattern: eval($X)
    message: Avoid eval; use safe alternatives.
    severity: ERROR

  - id: no-new-function
    languages: [javascript, typescript]
    patterns:
      - pattern: new Function($ARGS)
    message: Avoid dynamic Function constructors.
    severity: ERROR

  - id: no-child-process
    languages: [javascript, typescript]
    patterns:
      - pattern-either:
          - pattern: require('child_process').$METHOD(...)
          - pattern: import 'child_process'
    message: Avoid child_process in repo code.
    severity: ERROR
